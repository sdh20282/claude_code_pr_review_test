name: Claude Code Review

on:
  pull_request:
    types: [opened, synchronize]
    # Optional: Only run on specific file changes
    # paths:
    #   - "src/**/*.ts"
    #   - "src/**/*.tsx"
    #   - "src/**/*.js"
    #   - "src/**/*.jsx"

jobs:
  claude-review:
    # Optional: Filter by PR author
    # if: |
    #   github.event.pull_request.user.login == 'external-contributor' ||
    #   github.event.pull_request.user.login == 'new-developer' ||
    #   github.event.pull_request.author_association == 'FIRST_TIME_CONTRIBUTOR'
    
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: read
      issues: read
      id-token: write
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: Run Claude Code Review
        id: claude-review
        uses: anthropics/claude-code-action@v1
        with:
          claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          prompt: |
            # ğŸ¤– AI ì—ì´ì „íŠ¸ ê¸°ë°˜ ì¢…í•© PR ë¦¬ë·°

            ì´ PRì„ ë‹¤ìŒ 3ê°€ì§€ ê´€ì ì—ì„œ ì¢…í•©ì ìœ¼ë¡œ ë¶„ì„í•´ì£¼ì„¸ìš”:

            ## 1. ì½”ë“œ êµ¬ì¡° ë° ë¡œì§ ë¶„ì„
            ë‹¤ìŒ ê´€ì ì—ì„œ ì§‘ì¤‘ì ìœ¼ë¡œ ê²€í† í•´ì£¼ì„¸ìš”:
            - ì½”ë“œ êµ¬ì¡°ì™€ ì•„í‚¤í…ì²˜ ë³€ê²½ì‚¬í•­
            - ë¡œì§ì˜ ì •í™•ì„± ë° ë²„ê·¸ íƒì§€
            - ì—ëŸ¬ ì²˜ë¦¬ ë° ì˜ˆì™¸ ìƒí™© ëŒ€ì‘
            - ì½”ë“œ ê°€ë…ì„± ë° ìœ ì§€ë³´ìˆ˜ì„±
            - íŒŒì¼ ê°„ ì¼ê´€ì„± ë° í†µí•©ì„±

            ## 2. ë³´ì•ˆ ë° ì„±ëŠ¥ ê²€í† 
            ë‹¤ìŒ ê´€ì ì—ì„œ ì§‘ì¤‘ì ìœ¼ë¡œ ë¶„ì„í•´ì£¼ì„¸ìš”:
            - ë³´ì•ˆ ì·¨ì•½ì  (XSS, ì…ë ¥ ê²€ì¦, ì¸ì¦/ì¸ê°€ ë“±)
            - ì„±ëŠ¥ ì´ìŠˆ ë° ìµœì í™” í¬ì¸íŠ¸
            - ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ê°€ëŠ¥ì„±
            - ë¸Œë¼ìš°ì €/í”Œë«í¼ í˜¸í™˜ì„± ì´ìŠˆ
            - ì˜ì¡´ì„± ë° ë¼ì´ë¸ŒëŸ¬ë¦¬ ë³´ì•ˆ

            ## 3. ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤ ë° ì½”ë“œ ìŠ¤íƒ€ì¼
            ë‹¤ìŒ ê´€ì ì—ì„œ í‰ê°€í•´ì£¼ì„¸ìš”:
            - ì–¸ì–´ë³„ ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤ ì¤€ìˆ˜
            - ë””ìì¸ íŒ¨í„´ í™œìš©
            - ì½”ë“œ ìŠ¤íƒ€ì¼ ì¼ê´€ì„±
            - ì£¼ì„ ë° ë¬¸ì„œí™” í’ˆì§ˆ
            - í…ŒìŠ¤íŠ¸ ê°€ëŠ¥ì„± ë° ëª¨ë“ˆí™”

            ë¨¼ì € `gh pr diff ${{ github.event.pull_request.number }}` ëª…ë ¹ì–´ë¡œ ì „ì²´ ë³€ê²½ì‚¬í•­ì„ í™•ì¸í•œ í›„, ìœ„ 3ê°€ì§€ ê´€ì ì„ í†µí•©í•˜ì—¬ ë‹¤ìŒ í…œí”Œë¦¿ìœ¼ë¡œ GitHub ì½”ë©˜íŠ¸ë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”:

            ```bash
            gh pr comment ${{ github.event.pull_request.number }} --body "$(cat <<'REVIEW_EOF'
            ## ğŸ¤– AI ì›Œí¬í”Œë¡œìš° ê¸°ë°˜ ì¢…í•© PR ë¦¬ë·°

            **PR #${{ github.event.pull_request.number }} ì „ì²´ ë¦¬ë·°ì…ë‹ˆë‹¤.**

            ### ğŸ“Š **ì¢…í•© í‰ê°€**
            - **ì½”ë“œ í’ˆì§ˆ**: [ì ìˆ˜]/10
            - **ë³´ì•ˆ ìœ„í—˜ë„**: [ë‚®ìŒ/ì¤‘ê°„/ë†’ìŒ]
            - **ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤**: [ì¤€ìˆ˜ë„]

            ---

            ## ğŸ”´ **ê¸´ê¸‰ ìˆ˜ì • í•„ìš” (Critical)**
            [Critical ì´ìŠˆë“¤ ì •ë¦¬]

            ---

            ## ğŸŸ¡ **ì¤‘ìš” ê°œì„ ì‚¬í•­ (Major)**
            [Major ì´ìŠˆë“¤ ì •ë¦¬]

            ---

            ## ğŸŸ¢ **ê¶Œì¥ ê°œì„ ì‚¬í•­ (Minor)**
            [Minor ì´ìŠˆë“¤ ì •ë¦¬]

            ---

            ## âœ… **ì˜ êµ¬í˜„ëœ ë¶€ë¶„**
            [ë°œê²¬í•œ ê°•ì ë“¤ ì •ë¦¬]

            ---

            ## ğŸ¯ **ìš°ì„  ìˆ˜ì • ê¶Œì¥ì‚¬í•­**
            [ìš°ì„ ìˆœìœ„ë³„ ìˆ˜ì •ì‚¬í•­ ë‚˜ì—´]

            ---

            **ğŸ¤– ì´ ë¦¬ë·°ëŠ” ì½”ë“œí’ˆì§ˆ, ë³´ì•ˆì„±ëŠ¥, ë² ìŠ¤íŠ¸í”„ë™í‹°ìŠ¤ ê´€ì ì—ì„œ ë¶„ì„í•œ ì¢…í•© ê²°ê³¼ì…ë‹ˆë‹¤.**
            REVIEW_EOF
            )"
            ```

          # See https://github.com/anthropics/claude-code-action/blob/main/docs/usage.md
          # or https://docs.anthropic.com/en/docs/claude-code/sdk#command-line for available options
          claude_args: '--allowed-tools "Bash(gh issue view:*),Bash(gh search:*),Bash(gh issue list:*),Bash(gh pr comment:*),Bash(gh pr diff:*),Bash(gh pr view:*),Bash(gh pr list:*)"'

